:443
{
    bind 0.0.0.0
    encode gzip

    log {
        output stdout
        format console
    }
    tls {
        issuer internal
        on_demand
    }


    # Backend
    handle_path /api/* {
        reverse_proxy http://backend-prod:8000
    }

    # Frontend
    handle * {
        root * /app/dist/
        try_files {path} /index.html
        file_server
    }
}

:80 {
    redir https://{host}{uri} permanent
}

